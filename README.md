# IntegratedPower

ä¸€ä¸ªåŸºäº Rust å¼€å‘çš„ç°ä»£åŒ–æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ egui æ¡†æ¶æ„å»ºç”¨æˆ·ç•Œé¢ï¼Œå¹¶åˆ©ç”¨ Polars åº“è¿›è¡Œé«˜æ€§èƒ½çš„ Excel æ•°æ®å¤„ç†ã€‚

![åº”ç”¨ä¸»ç•Œé¢](image/img.png)
![æ—¥å¿—æŸ¥çœ‹å™¨](image/img_1.png)
![Excelç»“æ„åˆ†æ](image/img_2.png)

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ ç°ä»£åŒ–çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆåŸºäº eguiï¼‰
- ğŸ“Š é«˜æ€§èƒ½ Excel æ•°æ®å¤„ç†
- ğŸ”Œ æ’ä»¶å¼å¤„ç†å™¨æ¶æ„
- ğŸ¤– æ™ºèƒ½è¡Œç±»å‹è¯†åˆ«ç³»ç»Ÿ
- âš¡ å¹¶è¡Œæ‰¹é‡æ–‡ä»¶å¤„ç†
- ğŸŒ“ æµ…è‰²/æ·±è‰²/ç³»ç»Ÿä¸»é¢˜æ”¯æŒ
- ğŸ“œ æ“ä½œå†å²è®°å½•
- âš™ï¸ çµæ´»çš„é…ç½®ç®¡ç†
- ğŸ“¦ è´§ç‰©åˆ†æè¡¨è‡ªåŠ¨å¤„ç†

## æ ¸å¿ƒåŠŸèƒ½

### è¡Œç±»å‹è¯†åˆ«ç³»ç»Ÿ

IntegratedPower å†…ç½®äº†å¼ºå¤§çš„è¡Œç±»å‹è¯†åˆ«ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ« Excel æ–‡ä»¶ä¸­ä¸åŒç±»å‹çš„è¡Œï¼š

- **é¡¹ç›®ç¼–å·è¡Œ** - æµ…ç»¿è‰²èƒŒæ™¯ï¼ŒåŒ…å«é¡¹ç›®ç¼–å·
- **æŸœå·è¡Œ** - ç°è“è‰²èƒŒæ™¯æˆ–åŒ…å«"æŸœå·:"æ–‡æœ¬
- **è¡¨å¤´è¡Œ** - æµ…ç°è‰²èƒŒæ™¯
- **æ•°æ®è¡Œ** - æ— èƒŒæ™¯è‰²æˆ–ç™½è‰²èƒŒæ™¯
- **åˆè®¡è¡Œ** - æµ…ç²‰è‰²èƒŒæ™¯ï¼ŒåŒºåˆ†"å•å°åˆè®¡"ã€"å°è®¡"å’Œ"æ€»è®¡"

è¯†åˆ«ç³»ç»Ÿç‰¹ç‚¹ï¼š
- åŸºäºè§„åˆ™å¼•æ“ï¼Œæ”¯æŒé¢œè‰²ã€æ–‡æœ¬æ¨¡å¼ã€å•å…ƒæ ¼åˆå¹¶çŠ¶æ€ç­‰å¤šç§è¯†åˆ«æ¡ä»¶
- é«˜åº¦å¯é…ç½®ï¼Œæ”¯æŒè‡ªå®šä¹‰æ–‡ä»¶ç±»å‹é…ç½®
- æ”¯æŒè§„åˆ™ç»„åˆï¼ˆAND/ORé€»è¾‘ï¼‰
- ä¼˜å…ˆçº§æœºåˆ¶ç¡®ä¿å‡†ç¡®è¯†åˆ«

### è´§ç‰©åˆ†æè¡¨å¤„ç†å™¨

ä¸“é—¨ç”¨äºå¤„ç†è´§ç‰©åˆ†æè¡¨çš„æ™ºèƒ½å¤„ç†å™¨ï¼š

- è‡ªåŠ¨è¯†åˆ«è¡¨æ ¼ç»“æ„
- æå–é¡¹ç›®ç¼–å·ã€æŸœå·ä¿¡æ¯
- åˆ†ç»„å¤„ç†æ•°æ®è¡Œ
- ç”Ÿæˆæ±‡æ€»æŠ¥è¡¨
- æ”¯æŒæ‰¹é‡å¤„ç†

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Rust (edition 2021)
- **UI æ¡†æ¶**: egui + eframe
- **æ•°æ®å¤„ç†**: Polars + umya-spreadsheet
- **å¼‚æ­¥è¿è¡Œæ—¶**: Tokio
- **é…ç½®å­˜å‚¨**: Serde + TOML
- **æ—¥å¿—**: tracing + tracing-subscriber
- **é”™è¯¯å¤„ç†**: thiserror + anyhow

## é¡¹ç›®ç»“æ„

```
IntegratedPower/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs              # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ app.rs               # ä¸»åº”ç”¨ç¨‹åºé€»è¾‘
â”‚   â”œâ”€â”€ error.rs             # é”™è¯¯ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ui/                  # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ home.rs          # ä¸»é¡µè§†å›¾
â”‚   â”‚   â”œâ”€â”€ processing.rs    # å¤„ç†è¿›åº¦è§†å›¾
â”‚   â”‚   â”œâ”€â”€ settings.rs      # è®¾ç½®è§†å›¾
â”‚   â”‚   â””â”€â”€ log_viewer.rs    # æ—¥å¿—æŸ¥çœ‹å™¨
â”‚   â”œâ”€â”€ processor/           # å¤„ç†å™¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ trait_def.rs     # å¤„ç†å™¨ trait å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ manager.rs       # å¤„ç†å™¨ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ examples/        # ç¤ºä¾‹å¤„ç†å™¨
â”‚   â”‚       â””â”€â”€ cargo_analysis_processor.rs  # è´§ç‰©åˆ†æè¡¨å¤„ç†å™¨
â”‚   â”œâ”€â”€ engine/              # æ•°æ®å¤„ç†å¼•æ“
â”‚   â”‚   â”œâ”€â”€ data_engine.rs   # æ•°æ®å¼•æ“
â”‚   â”‚   â”œâ”€â”€ recognition_rule.rs  # è¯†åˆ«è§„åˆ™ trait
â”‚   â”‚   â”œâ”€â”€ rules/           # è¯†åˆ«è§„åˆ™å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ color_rule.rs        # é¢œè‰²è§„åˆ™
â”‚   â”‚   â”‚   â”œâ”€â”€ text_pattern_rule.rs # æ–‡æœ¬æ¨¡å¼è§„åˆ™
â”‚   â”‚   â”‚   â”œâ”€â”€ merge_state_rule.rs  # åˆå¹¶çŠ¶æ€è§„åˆ™
â”‚   â”‚   â”‚   â””â”€â”€ composite_rule.rs    # ç»„åˆè§„åˆ™
â”‚   â”‚   â”œâ”€â”€ file_type_profile.rs     # æ–‡ä»¶ç±»å‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ row_identifier.rs        # è¡Œç±»å‹è¯†åˆ«å™¨
â”‚   â”‚   â”œâ”€â”€ excel_extractor.rs       # Excel æ•°æ®æå–
â”‚   â”‚   â””â”€â”€ identification_error.rs  # è¯†åˆ«é”™è¯¯ç±»å‹
â”‚   â”œâ”€â”€ config/              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ history/             # å†å²è®°å½•ç®¡ç†
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ row_type.rs      # è¡Œç±»å‹æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ logger.rs            # æ—¥å¿—é…ç½®
â”œâ”€â”€ resources/               # èµ„æºæ–‡ä»¶
â”œâ”€â”€ image/                   # æ–‡æ¡£å›¾ç‰‡
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â””â”€â”€ tests/                   # æµ‹è¯•
```

## æ„å»ºå’Œè¿è¡Œ

### å‰ç½®è¦æ±‚

- Rust 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ— éœ€é¢å¤–ä¾èµ–ï¼ˆæ‰€æœ‰ä¾èµ–é€šè¿‡ Cargo è‡ªåŠ¨ç®¡ç†ï¼‰

### æ„å»º

```bash
# å¼€å‘æ„å»º
cargo build

# å‘å¸ƒæ„å»º
cargo build --release
```

### è¿è¡Œ

```bash
# å¼€å‘æ¨¡å¼
cargo run

# å‘å¸ƒæ¨¡å¼
cargo run --release
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæ¨¡å—çš„æµ‹è¯•
cargo test engine::

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -- --nocapture
```

## ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ä½¿ç”¨æµç¨‹

1. **å¯åŠ¨åº”ç”¨** - è¿è¡Œç¨‹åºåè¿›å…¥ä¸»ç•Œé¢
2. **é€‰æ‹©å¤„ç†å™¨** - ä»å¯ç”¨å¤„ç†å™¨åˆ—è¡¨ä¸­é€‰æ‹©éœ€è¦çš„å¤„ç†å™¨ï¼ˆå¦‚"è´§ç‰©åˆ†æè¡¨å¤„ç†å™¨"ï¼‰
3. **é€‰æ‹©ç›®å½•** - æŒ‡å®šè¾“å…¥ç›®å½•ï¼ˆåŒ…å«å¾…å¤„ç†çš„ Excel æ–‡ä»¶ï¼‰å’Œè¾“å‡ºç›®å½•
4. **å¼€å§‹å¤„ç†** - ç‚¹å‡»"å¼€å§‹å¤„ç†"æŒ‰é’®
5. **æŸ¥çœ‹è¿›åº¦** - å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦å’Œæ—¥å¿—
6. **æŸ¥çœ‹ç»“æœ** - å¤„ç†å®Œæˆååœ¨è¾“å‡ºç›®å½•æŸ¥çœ‹ç»“æœæ–‡ä»¶

### é…ç½®æ–‡ä»¶

åº”ç”¨é…ç½®æ–‡ä»¶ä½äºï¼š
- Windows: `%APPDATA%\IntegratedPower\config.toml`
- Linux: `~/.config/IntegratedPower/config.toml`
- macOS: `~/Library/Application Support/IntegratedPower/config.toml`

### æ—¥å¿—æ–‡ä»¶

æ—¥å¿—æ–‡ä»¶ä½äºï¼š
- Windows: `%APPDATA%\IntegratedPower\logs\`
- Linux: `~/.local/share/IntegratedPower/logs/`
- macOS: `~/Library/Application Support/IntegratedPower/logs/`

## æ‰©å±•å¼€å‘

### åˆ›å»ºè‡ªå®šä¹‰å¤„ç†å™¨

å®ç° `DataProcessor` traitï¼š

```rust
use crate::processor::DataProcessor;
use async_trait::async_trait;
use polars::prelude::*;

pub struct MyCustomProcessor;

#[async_trait]
impl DataProcessor for MyCustomProcessor {
    fn id(&self) -> &str {
        "my_custom_processor"
    }

    fn name(&self) -> &str {
        "æˆ‘çš„è‡ªå®šä¹‰å¤„ç†å™¨"
    }

    fn description(&self) -> &str {
        "å¤„ç†å™¨æè¿°"
    }

    async fn process(&self, df: DataFrame) -> Result<DataFrame> {
        // å®ç°å¤„ç†é€»è¾‘
        Ok(df)
    }
}
```

### åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶ç±»å‹é…ç½®

```rust
use crate::engine::{FileTypeProfile, RowTypeDefinition, ColorRule};
use crate::models::{RowType, RgbColor};

let mut profile = FileTypeProfile::new(
    "my_file_type".to_string(),
    "æˆ‘çš„æ–‡ä»¶ç±»å‹".to_string(),
);

profile.add_row_type(RowTypeDefinition::new(
    RowType::Header,
    "è¡¨å¤´è¡Œ".to_string(),
    "ç°è‰²èƒŒæ™¯".to_string(),
    Box::new(ColorRule::new(
        "header_rule".to_string(),
        RgbColor::new(200, 200, 200),
        None,
    )),
    9, // ä¼˜å…ˆçº§
));
```

## å¼€å‘çŠ¶æ€

é¡¹ç›®æ­£åœ¨ç§¯æå¼€å‘ä¸­ã€‚å½“å‰å·²å®Œæˆï¼š

- âœ… æ ¸å¿ƒ UI æ¡†æ¶
- âœ… æ•°æ®å¤„ç†å¼•æ“
- âœ… è¡Œç±»å‹è¯†åˆ«ç³»ç»Ÿ
- âœ… è´§ç‰©åˆ†æè¡¨å¤„ç†å™¨
- âœ… é…ç½®ç®¡ç†ç³»ç»Ÿ
- âœ… å†å²è®°å½•åŠŸèƒ½
- âœ… æ—¥å¿—ç³»ç»Ÿ

è®¡åˆ’ä¸­çš„åŠŸèƒ½ï¼š

- ğŸ”„ è¾…æå¤„ç†å™¨
- ğŸ”„ æ›´å¤šæ–‡ä»¶ç±»å‹æ”¯æŒ
- ğŸ”„ æ•°æ®å¯è§†åŒ–
- ğŸ”„ å¯¼å‡ºæŠ¥è¡¨åŠŸèƒ½

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

## è®¸å¯è¯

å¾…å®š

## è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [egui](https://github.com/emilk/egui) - å³æ—¶æ¨¡å¼ GUI æ¡†æ¶
- [Polars](https://github.com/pola-rs/polars) - å¿«é€Ÿ DataFrame åº“
- [umya-spreadsheet](https://github.com/MathNya/umya-spreadsheet) - Excel æ–‡ä»¶å¤„ç†
- [Tokio](https://github.com/tokio-rs/tokio) - å¼‚æ­¥è¿è¡Œæ—¶
